from androguard.core.bytecodes import apk
import os
import glob
import csv
import collections


defpermissions={
		
		"AAPP_NAME": -1,
		"android.permission.ACCESS_CHECKIN_PROPERTIES":0,	
		"android.permission.ACCESS_COARSE_LOCATION":1,
		"android.permission.ACCESS_FINE_LOCATION":2,
		"android.permission.ACCESS_LOCATION_EXTRA_COMMANDS":3,
		"android.permission.ACCESS_NETWORK_STATE":4,
		"android.permission.ACCESS_NOTIFICATION_POLICY":5,
		"android.permission.ACCESS_WIFI_STATE":6,
		"android.permission.ACCOUNT_MANAGER":7,
		"android.permission.ADD_VOICEMAIL":8,
		"android.permission.BATTERY_STATS":9,
		"android.permission.BIND_ACCESSIBILITY_SERVICE":10,
		"android.permission.BIND_APPWIDGET":11,
		"android.permission.BIND_CARRIER_MESSAGING_SERVICE":12,
		"android.permission.BIND_CARRIER_SERVICES":13,
		"android.permission.BIND_CHOOSER_TARGET_SERVICE":14,
		"android.permission.BIND_DEVICE_ADMIN":15,
		"android.permission.BIND_DREAM_SERVICE":16,
		"android.permission.BIND_INCALL_SERVICE":17,
		"android.permission.BIND_INPUT_METHOD":18,
		"android.permission.BIND_MIDI_DEVICE_SERVICE":19,
		"android.permission.BIND_NFC_SERVICE":20,
		"android.permission.BIND_NOTIFICATION_LISTENER_SERVICE":21,
		"android.permission.BIND_PRINT_SERVICE":22,
		"android.permission.BIND_REMOTEVIEWS":23,
		"android.permission.BIND_TELECOM_CONNECTION_SERVICE":24,
		"android.permission.BIND_TEXT_SERVICE":25,
		"android.permission.BIND_TV_INPUT":26,
		"android.permission.BIND_VOICE_INTERACTION":27,
		"android.permission.BIND_VPN_SERVICE":28,
		"android.permission.BIND_WALLPAPER":29,
		"android.permission.BLUETOOTH":30,
		"android.permission.BLUETOOTH_ADMIN":31,
		"android.permission.BLUETOOTH_PRIVILEGED":32,
		"android.permission.BODY_SENSORS":33,
		"android.permission.BROADCAST_PACKAGE_REMOVED":34,
		"android.permission.BROADCAST_SMS":35,
		"android.permission.BROADCAST_STICKY":36,
		"android.permission.BROADCAST_WAP_PUSH":37,
		"android.permission.CALL_PHONE":38,
		"android.permission.CALL_PRIVILEGED":39,
		"android.permission.CAMERA":40,
		"android.permission.CAPTURE_AUDIO_OUTPUT":41,
		"android.permission.CAPTURE_SECURE_VIDEO_OUTPUT":42,
		"android.permission.CAPTURE_VIDEO_OUTPUT":43,
		"android.permission.CHANGE_COMPONENT_ENABLED_STATE":44,
		"android.permission.CHANGE_CONFIGURATION":45,
		"android.permission.CHANGE_NETWORK_STATE":46,
		"android.permission.CHANGE_WIFI_MULTICAST_STATE":47,
		"android.permission.CHANGE_WIFI_STATE":48,
		"android.permission.CLEAR_APP_CACHE":49,
		"android.permission.CONTROL_LOCATION_UPDATES":50,
		"android.permission.DELETE_CACHE_FILES":51,
		"android.permission.DELETE_PACKAGES":52,
		"android.permission.DIAGNOSTIC":53,
		"android.permission.DISABLE_KEYGUARD":54,
		"android.permission.DUMP":55,
		"android.permission.EXPAND_STATUS_BAR":56,
		"android.permission.FACTORY_TEST":57,
		"android.permission.FLASHLIGHT":58,
		"android.permission.GET_ACCOUNTS":59,
		"android.permission.GET_ACCOUNTS_PRIVILEGED":60,
		"android.permission.GET_PACKAGE_SIZE":67,
		"android.permission.GET_TASKS":68,
		"android.permission.GLOBAL_SEARCH":69,
		"android.permission.INSTALL_LOCATION_PROVIDER":70,
		"android.permission.INSTALL_PACKAGES":71,
		"android.permission.INSTALL_SHORTCUT":72,
		"android.permission.INTERNET":73,
		"android.permission.KILL_BACKGROUND_PROCESSES":74,
		"android.permission.LOCATION_HARDWARE":75,
		"android.permission.MANAGE_DOCUMENTS":76,
		"android.permission.MASTER_CLEAR":77,
		"android.permission.MEDIA_CONTENT_CONTROL":78,
		"android.permission.MODIFY_AUDIO_SETTINGS":79,
		"android.permission.MODIFY_PHONE_STATE":80,
		"android.permission.MOUNT_FORMAT_FILESYSTEMS":81,
		"android.permission.MOUNT_UNMOUNT_FILESYSTEMS":82,
		"android.permission.NFC":83,
		"android.permission.PACKAGE_USAGE_STATS":84,
		"android.permission.PERSISTENT_ACTIVITY":85,
		"android.permission.PROCESS_OUTGOING_CALLS":86,
		"android.permission.READ_CALENDAR":87,
		"android.permission.READ_CALL_LOG":88,
		"android.permission.READ_CONTACTS":89,
		"android.permission.READ_EXTERNAL_STORAGE":90,
		"android.permission.READ_FRAME_BUFFER":91,
		"android.permission.READ_INPUT_STATE":92,
		"android.permission.READ_LOGS":93,
		"android.permission.READ_PHONE_STATE":94,
		"android.permission.READ_SMS":95,
		"android.permission.READ_SYNC_SETTINGS":96,
		"android.permission.READ_SYNC_STATS":97,
		"android.permission.READ_VOICEMAIL":98,
		"android.permission.REBOOT":99,
		"android.permission.RECEIVE_BOOT_COMPLETED":100,
		"android.permission.RECEIVE_MMS":101,
		"android.permission.RECEIVE_SMS":102,
		"android.permission.RECEIVE_WAP_PUSH":103,
		"android.permission.RECORD_AUDIO":104,
		"android.permission.REORDER_TASKS":105,
		"android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS":106,
		"android.permission.REQUEST_INSTALL_PACKAGES":107,
		"android.permission.RESTART_PACKAGES":108,
		"android.permission.SEND_RESPOND_VIA_MESSAGE":109,
		"android.permission.SEND_SMS":110,
		"android.permission.SET_ALARM":111,
		"android.permission.SET_ALWAYS_FINISH":112,
		"android.permission.SET_ANIMATION_SCALE":113,
		"android.permission.SET_DEBUG_APP":114,
		"android.permission.SET_PREFERRED_APPLICATIONS":115,
		"android.permission.SET_PROCESS_LIMIT":116,
		"android.permission.SET_TIME":117,
		"android.permission.SET_TIME_ZONE":118,
		"android.permission.SET_WALLPAPER":119,
		"android.permission.SET_WALLPAPER_HINTS":120,
		"android.permission.SIGNAL_PERSISTENT_PROCESSES":121,
		"android.permission.STATUS_BAR":122,
		"android.permission.SYSTEM_ALERT_WINDOW":123,
		"android.permission.TRANSMIT_IR":124,
		"android.permission.UNINSTALL_SHORTCUT":125,
		"android.permission.UPDATE_DEVICE_STATS":126,
		"android.permission.USE_FINGERPRINT":127,
		"android.permission.USE_SIP":128,
		"android.permission.VIBRATE":129,
		"android.permission.WAKE_LOCK":130,
		"android.permission.WRITE_APN_SETTINGS":131,
		"android.permission.WRITE_CALENDAR":132,
		"android.permission.WRITE_CALL_LOG":133,
		"android.permission.WRITE_CONTACTS":134,
		"android.permission.WRITE_EXTERNAL_STORAGE":135,
		"android.permission.WRITE_GSERVICES":136,
		"android.permission.WRITE_SECURE_SETTINGS":137,
		"android.permission.WRITE_SETTINGS":138,
		"android.permission.WRITE_SYNC_SETTINGS":139,
		"android.permission.WRITE_VOICEMAIL":140
	    }


BASE_DIR="/home/anish/project/"

APK_PATH="testapk"

count =0

os.chdir(BASE_DIR + APK_PATH)

od= collections.OrderedDict(sorted(defpermissions.items()))

mywriter = csv.DictWriter(
			open("/home/anish/project/androguard/main.csv","a"),
			fieldnames=od.keys(),
			delimiter=',',
			quotechar='|',
			quoting=csv.QUOTE_MINIMAL
			)	

mywriter.writeheader()	

for file in glob.glob("*.apk"):

	
	count = count +1
	
	#print(`count` +"\n")

	print(`count`+".PERMISSIONS FOR "+ file +"\n")
	
	try:	
	
		for item in defpermissions:		
			defpermissions[item]=0
	
		myapp=apk.APK(open(BASE_DIR + APK_PATH +"/"+ file ,"rb").read(),raw=True)

		permissions=myapp.get_permissions()
	
		defpermissions["AAPP_NAME"]=file		

		for permission in permissions:
			print permission
			defpermissions[permission]=1

		mywriter.writerow(defpermissions)
			

	except Exception, e:
		print str(e)


#mywriter.close()
print("\n")       

